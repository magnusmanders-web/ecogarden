<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a1a0f">
  <title>EcoGarden</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css?v={{ v }}">
</head>
<body>
  <!-- Animated background foliage -->
  <div class="bg-foliage">
    <div class="leaf leaf-1"></div>
    <div class="leaf leaf-2"></div>
    <div class="leaf leaf-3"></div>
  </div>

  <header>
    <div class="header-content">
      <div class="header-left">
        <div class="logo-mark">
          <svg viewBox="0 0 28 28" fill="none"><path d="M14 3C14 3 8 8 8 14c0 3.3 2.7 6 6 6s6-2.7 6-6c0-6-6-11-6-11z" fill="currentColor" opacity="0.3"/><path d="M14 7c0 0-4 3.5-4 8 0 2.2 1.8 4 4 4s4-1.8 4-4c0-4.5-4-8-4-8z" fill="currentColor"/><line x1="14" y1="19" x2="14" y2="26" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </div>
        <div>
          <h1>EcoGarden</h1>
          <div class="header-sub">
            <span id="mqtt-status" class="status-dot disconnected"></span>
            <span class="header-sub-text" id="header-sub-text">Connecting...</span>
          </div>
        </div>
      </div>
      <div class="header-right">
        <button id="light-btn" class="ctrl-btn light-off" onclick="toggleLight()" title="Toggle growlight">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
        </button>
        <button id="feed-btn" class="ctrl-btn" onclick="feedNow()" title="Feed fish">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 16s1-4 6-4c3 0 4 2 7 2s5-3 7-3"/><path d="M22 12c0 0-2-1-4 0s-3 3-6 3-4-2-7-2c-2 0-3 1-3 1"/><circle cx="19" cy="10" r="1" fill="currentColor" stroke="none"/><path d="M21 8l2-1M21 14l2 1"/></svg>
        </button>
        <button id="capture-btn" class="ctrl-btn" onclick="manualCapture()" title="Take photo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        </button>
      </div>
    </div>
  </header>

  <main>
    <!-- Sensor orbs -->
    <div class="sensor-orbs anim-rise" style="--d:0">
      <div class="sensor-orb">
        <div class="orb-ring"></div>
        <span class="orb-val" id="sensor-temp">--</span>
        <span class="orb-lbl">&deg;C water</span>
      </div>
      <div class="sensor-orb health-orb">
        <div class="orb-ring"></div>
        <span class="orb-val health-score" id="overall-health">--</span>
        <span class="orb-lbl">health</span>
      </div>
    </div>

    <!-- Alerts -->
    <div id="alerts-container" class="alerts-container" style="display:none;">
      <div id="alerts-list"></div>
    </div>

    <!-- Latest Photo -->
    <section class="card photo-card anim-rise" style="--d:1">
      <div class="photo-frame">
        <img id="latest-photo" src="" alt="Latest plant photo" onclick="openFullscreen(this)">
        <div id="photo-no-data" class="no-data">
          <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5" class="no-data-icon"><rect x="6" y="10" width="36" height="28" rx="3"/><circle cx="18" cy="22" r="4"/><path d="M42 34l-10-10-8 8-4-4-14 10"/></svg>
          <span>No photos yet</span>
        </div>
        <div class="photo-overlay">
          <span id="photo-time" class="photo-time"></span>
        </div>
      </div>
      <div class="thumbnail-strip" id="thumbnail-strip"></div>
    </section>

    <!-- AI Summary -->
    <section id="ai-summary" class="card ai-card anim-rise" style="display:none; --d:2">
      <div class="ai-header">
        <div class="ai-badge">
          <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12"><path d="M8 1.5a.5.5 0 01.5.5v2a.5.5 0 01-1 0V2a.5.5 0 01.5-.5zM3.146 3.146a.5.5 0 01.708 0l1.5 1.5a.5.5 0 11-.708.708l-1.5-1.5a.5.5 0 010-.708zM1.5 8a.5.5 0 01.5-.5h2a.5.5 0 010 1H2a.5.5 0 01-.5-.5zm10 0a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM4.646 11.354a.5.5 0 010-.708l1.5-1.5a.5.5 0 01.708.708l-1.5 1.5a.5.5 0 01-.708 0zm6-.708a.5.5 0 01.708 0l1.5 1.5a.5.5 0 01-.708.708l-1.5-1.5a.5.5 0 010-.708zM8 12.5a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2a.5.5 0 01.5-.5zM8 5a3 3 0 100 6 3 3 0 000-6z"/></svg>
          AI Analysis
        </div>
        <span id="ai-summary-date" class="ai-date"></span>
      </div>
      <p id="ai-summary-text" class="ai-text"></p>
    </section>

    <!-- Plant Cards -->
    <section class="plants-section">
      <div id="plant-cards"></div>
    </section>

    <!-- Light Sensor History -->
    <section class="card glass-card light-card anim-rise" style="--d:3">
      <div class="card-header">
        <h2>
          <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16" class="card-icon"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/></svg>
          Light Sensor
        </h2>
        <div class="toggle-pills">
          <button class="pill active" data-range="24h" onclick="loadLightHistory('24h', this)">24h</button>
          <button class="pill" data-range="7d" onclick="loadLightHistory('7d', this)">7d</button>
        </div>
      </div>
      <div class="light-chart-container">
        <svg id="light-chart" viewBox="0 0 600 200" preserveAspectRatio="none"></svg>
        <div id="light-no-data" class="no-data" style="display:none;">No light data</div>
      </div>
    </section>

    <!-- Temperature History -->
    <section class="card glass-card light-card anim-rise" style="--d:3">
      <div class="card-header">
        <h2>
          <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16" class="card-icon"><path d="M10 2a2 2 0 00-2 2v7.252A3 3 0 1013 14V4a2 2 0 00-2-2zm0 2v7.252a1 1 0 01-.293.708A1 1 0 009 12.5a1.5 1.5 0 102.121.621A1 1 0 0111 12.5V4a1 1 0 10-2 0h1z"/></svg>
          Water Temperature
        </h2>
      </div>
      <div class="light-chart-container">
        <svg id="temp-chart" viewBox="0 0 600 200" preserveAspectRatio="none"></svg>
        <div id="temp-no-data" class="no-data">Collecting data...</div>
      </div>
    </section>

    <!-- Timelapse -->
    <section class="card glass-card timelapse-card anim-rise" style="--d:4">
      <div class="card-header">
        <h2>
          <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16" class="card-icon"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
          Timelapse
        </h2>
        <div class="timelapse-controls">
          <select id="timelapse-type" onchange="loadTimelapses()">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
          </select>
          <select id="timelapse-select" onchange="playTimelapse()"></select>
          <button id="timelapse-gen-btn" class="gen-btn" onclick="generateTimelapse()">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M4 2l10 6-10 6V2z"/></svg>
            Generate
          </button>
        </div>
      </div>
      <div id="timelapse-gen-status" class="gen-status" style="display:none;">
        <div class="gen-spinner"></div>
        <span id="timelapse-gen-label">Generating timelapse...</span>
      </div>
      <div class="timelapse-player">
        <video id="timelapse-video" controls playsinline></video>
        <div id="timelapse-no-data" class="no-data">No timelapses yet</div>
      </div>
    </section>

    <!-- Storage Status -->
    <section class="card glass-card storage-card anim-rise" style="--d:5">
      <div class="card-header">
        <h2>
          <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16" class="card-icon"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/></svg>
          Storage
        </h2>
      </div>
      <div id="storage-info" class="storage-info">
        <div class="storage-stats">
          <div class="stat-chip"><span class="stat-val" id="storage-photos">--</span> photos</div>
          <div class="stat-chip"><span class="stat-val" id="storage-size">--</span> MB</div>
          <div class="stat-chip"><span class="stat-val" id="storage-timelapses">--</span> videos</div>
        </div>
        <div class="storage-bar">
          <div id="storage-bar-fill" class="storage-bar-fill">
            <div class="storage-bar-glow"></div>
          </div>
        </div>
        <div id="storage-forecast" class="storage-forecast"></div>
      </div>
    </section>

    <footer class="site-footer">
      <span>EcoGarden Monitor</span>
    </footer>
  </main>

  <!-- Fullscreen overlay -->
  <div id="fullscreen-overlay" class="fullscreen-overlay" onclick="closeFullscreen()">
    <button class="fullscreen-close" onclick="closeFullscreen()">&times;</button>
    <img id="fullscreen-img" src="" alt="Full size photo" onclick="event.stopPropagation()">
    <button id="fullscreen-delete-btn" class="fullscreen-delete" onclick="event.stopPropagation(); deleteFullscreenPhoto()">
      <svg viewBox="0 0 20 20" fill="currentColor" width="16" height="16"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"/></svg>
      Delete
    </button>
  </div>

  <!-- Swimming fish buddy (desktop only) -->
  <div id="fish" class="fish" aria-hidden="true" onclick="fishClick()">
    <div class="fish-glow"></div>
    <div class="fish-body">
      <svg viewBox="0 0 88 56" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <radialGradient id="fgBody" cx="38%" cy="40%" r="55%">
            <stop offset="0%" stop-color="#ffe066"/>
            <stop offset="45%" stop-color="#ffaa22"/>
            <stop offset="100%" stop-color="#dd6600"/>
          </radialGradient>
          <radialGradient id="fgBelly" cx="50%" cy="70%" r="50%">
            <stop offset="0%" stop-color="#fff8e0" stop-opacity="0.55"/>
            <stop offset="100%" stop-color="#fff8e0" stop-opacity="0"/>
          </radialGradient>
          <linearGradient id="fgTail" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#ff9900"/>
            <stop offset="100%" stop-color="#ff6600" stop-opacity="0.7"/>
          </linearGradient>
          <linearGradient id="fgFin" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#ffbb44" stop-opacity="0.8"/>
            <stop offset="100%" stop-color="#ff8800" stop-opacity="0.4"/>
          </linearGradient>
          <filter id="fgGlow"><feGaussianBlur stdDeviation="1.5" result="g"/><feMerge><feMergeNode in="g"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <!-- Tail -->
        <g class="fish-tail-g">
          <path d="M62 28 Q68 12 80 6 Q74 18 72 28 Q74 38 80 50 Q68 44 62 28Z" fill="url(#fgTail)"/>
          <path d="M64 28 Q69 16 76 12 Q72 22 70 28 Q72 34 76 44 Q69 40 64 28Z" fill="#ffcc55" opacity="0.3"/>
        </g>
        <!-- Dorsal fin -->
        <g class="fish-dorsal-g">
          <path d="M30 14 Q34 2 44 6 Q42 10 38 14 Q34 15 30 14Z" fill="url(#fgFin)"/>
        </g>
        <!-- Body -->
        <ellipse cx="38" cy="28" rx="27" ry="17" fill="url(#fgBody)"/>
        <ellipse cx="36" cy="33" rx="18" ry="9" fill="url(#fgBelly)"/>
        <!-- Scales shimmer -->
        <circle cx="30" cy="24" r="5" fill="none" stroke="#ffdd88" stroke-width="0.4" opacity="0.25"/>
        <circle cx="40" cy="22" r="5" fill="none" stroke="#ffdd88" stroke-width="0.4" opacity="0.2"/>
        <circle cx="35" cy="31" r="5" fill="none" stroke="#ffdd88" stroke-width="0.4" opacity="0.2"/>
        <circle cx="45" cy="28" r="5" fill="none" stroke="#ffdd88" stroke-width="0.4" opacity="0.15"/>
        <circle cx="26" cy="30" r="4" fill="none" stroke="#ffdd88" stroke-width="0.3" opacity="0.15"/>
        <!-- Orange patches -->
        <ellipse cx="42" cy="25" rx="8" ry="5" fill="#ff7700" opacity="0.15"/>
        <ellipse cx="28" cy="32" rx="6" ry="4" fill="#ff6600" opacity="0.1"/>
        <!-- Pectoral fin -->
        <g class="fish-pec-g">
          <path d="M32 36 Q26 44 34 48 Q36 42 34 36Z" fill="url(#fgFin)"/>
        </g>
        <!-- Eye white -->
        <ellipse cx="22" cy="24" rx="5.5" ry="6" fill="white"/>
        <!-- Iris -->
        <ellipse class="fish-iris" cx="21" cy="23.5" rx="3.8" ry="4.2" fill="#1a1a2e"/>
        <!-- Pupil shine -->
        <circle cx="19.5" cy="21.5" r="1.8" fill="white" opacity="0.9"/>
        <circle cx="22.5" cy="25" r="0.7" fill="white" opacity="0.5"/>
        <!-- Mouth -->
        <path class="fish-mouth" d="M12 31 Q16 34 20 32" fill="none" stroke="#cc5500" stroke-width="1.2" stroke-linecap="round"/>
        <!-- Blush -->
        <ellipse cx="24" cy="32" rx="4" ry="2.5" fill="#ff6666" opacity="0.15"/>
        <!-- Whiskers -->
        <line x1="12" y1="28" x2="6" y2="26" stroke="#ddaa44" stroke-width="0.6" opacity="0.4" stroke-linecap="round"/>
        <line x1="12" y1="30" x2="6" y2="31" stroke="#ddaa44" stroke-width="0.6" opacity="0.4" stroke-linecap="round"/>
        <!-- Body shine -->
        <ellipse cx="32" cy="18" rx="12" ry="4" fill="white" opacity="0.08" filter="url(#fgGlow)"/>
      </svg>
    </div>
    <div class="fish-bubbles" id="fish-bubbles"></div>
    <div class="fish-speech" id="fish-speech">
      <div class="fish-speech-header" id="fish-speech-header"></div>
      <div class="fish-speech-text" id="fish-speech-text"></div>
      <div class="fish-speech-tail"></div>
    </div>
  </div>

  <script src="/static/app.js?v={{ v }}"></script>
</body>
</html>
