# Home Assistant Configuration
# Start: cd ~/homeassistant && docker compose up -d
# Access: http://localhost:8123

homeassistant:
  name: Home
  unit_system: metric
  time_zone: Europe/Stockholm
  country: "SE"

# Loads default set of integrations. Do not remove.
default_config:

# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes

# Custom dashboard
lovelace:
  mode: storage
  dashboards:
    lovelace-home:
      mode: yaml
      title: Home Dashboard
      icon: mdi:home-assistant
      show_in_sidebar: true
      filename: ui-lovelace.yaml

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# ===== EcoGarden Integration =====
# Custom firmware endpoints at http://192.168.1.196

sensor:
  - platform: rest
    name: EcoGarden Light Level
    resource: http://192.168.1.196/hooks/light_sensor
    value_template: "{{ (value_json.value * 100) | round(1) }}"
    unit_of_measurement: "%"
    scan_interval: 30

  - platform: rest
    name: EcoGarden Water Temperature
    resource: http://192.168.1.196/hooks/water_temperature
    value_template: "{{ value_json.value | round(1) }}"
    unit_of_measurement: "Â°C"
    device_class: temperature
    scan_interval: 60

rest_command:
  ecogarden_led_on:
    url: "http://192.168.1.196/hooks/set_led_brightness?value=1"
  ecogarden_led_off:
    url: "http://192.168.1.196/hooks/set_led_brightness?value=0"
  ecogarden_set_brightness:
    url: "http://192.168.1.196/hooks/set_led_brightness?value={{ brightness }}"
  ecogarden_feed:
    url: "http://192.168.1.196/hooks/feed_now"

# EcoGarden light as a template light entity
light:
  - platform: template
    lights:
      ecogarden_growlight:
        friendly_name: "EcoGarden Growlight"
        turn_on:
          service: rest_command.ecogarden_led_on
        turn_off:
          service: rest_command.ecogarden_led_off

# ===== InfluxDB for Grafana =====
influxdb:
  api_version: 2
  host: influxdb
  port: 8086
  token: ecogarden-influx-token-2024
  organization: home
  bucket: homeassistant
  ssl: false
  include:
    entity_globs:
      - sensor.ecogarden_*
      - light.ecogarden_*
      - sensor.tibber_*
    domains:
      - sensor
      - light
      - climate
