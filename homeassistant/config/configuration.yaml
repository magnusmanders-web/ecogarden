# Home Assistant Configuration for EcoGarden
# See: https://www.home-assistant.io/docs/configuration/

homeassistant:
  name: Home
  unit_system: metric
  time_zone: Europe/Oslo

# Enable default config (frontend, history, logbook, etc.)
default_config:

# EcoGarden sensor configuration
sensor:
  - platform: rest
    name: EcoGarden Light Level
    resource: http://YOUR_ECOGARDEN_IP/hooks/light_sensor
    value_template: "{{ (value_json.value * 100) | round(1) }}"
    unit_of_measurement: "%"
    scan_interval: 30

  - platform: rest
    name: EcoGarden Water Temperature
    resource: http://YOUR_ECOGARDEN_IP/hooks/water_temperature
    value_template: "{{ value_json.value | round(1) }}"
    unit_of_measurement: "Â°C"
    device_class: temperature
    scan_interval: 60

# EcoGarden light (growlight) control
light:
  - platform: template
    lights:
      ecogarden_growlight:
        friendly_name: "EcoGarden Growlight"
        value_template: "{{ states('input_boolean.ecogarden_led_state') }}"
        turn_on:
          service: rest_command.ecogarden_led_on
        turn_off:
          service: rest_command.ecogarden_led_off
        set_level:
          service: rest_command.ecogarden_set_brightness
          data:
            brightness: "{{ (brightness / 255) | round(2) }}"

# EcoGarden REST commands
rest_command:
  ecogarden_led_on:
    url: "http://YOUR_ECOGARDEN_IP/hooks/set_led_brightness?value=1"
    method: GET

  ecogarden_led_off:
    url: "http://YOUR_ECOGARDEN_IP/hooks/set_led_brightness?value=0"
    method: GET

  ecogarden_set_brightness:
    url: "http://YOUR_ECOGARDEN_IP/hooks/set_led_brightness?value={{ brightness }}"
    method: GET

  ecogarden_auto_brightness_on:
    url: "http://YOUR_ECOGARDEN_IP/hooks/set_automatic_led_brightness?value=1"
    method: GET

  ecogarden_auto_brightness_off:
    url: "http://YOUR_ECOGARDEN_IP/hooks/set_automatic_led_brightness?value=0"
    method: GET

  ecogarden_feed:
    url: "http://YOUR_ECOGARDEN_IP/hooks/feed_now"
    method: GET

# Track LED and auto brightness state
input_boolean:
  ecogarden_led_state:
    name: EcoGarden LED State
    initial: off
  ecogarden_auto_brightness:
    name: EcoGarden Auto Brightness
    initial: off

# Automations to sync LED state
automation:
  - alias: "EcoGarden LED On - Update State"
    trigger:
      platform: event
      event_type: call_service
      event_data:
        domain: rest_command
        service: ecogarden_led_on
    action:
      service: input_boolean.turn_on
      target:
        entity_id: input_boolean.ecogarden_led_state

  - alias: "EcoGarden LED Off - Update State"
    trigger:
      platform: event
      event_type: call_service
      event_data:
        domain: rest_command
        service: ecogarden_led_off
    action:
      service: input_boolean.turn_off
      target:
        entity_id: input_boolean.ecogarden_led_state

# Scripts for easy dashboard access
script:
  ecogarden_feed_fish:
    alias: "Feed Fish"
    sequence:
      - service: rest_command.ecogarden_feed

  ecogarden_toggle_auto_brightness:
    alias: "Toggle Auto Brightness"
    sequence:
      - service: input_boolean.toggle
        target:
          entity_id: input_boolean.ecogarden_auto_brightness
